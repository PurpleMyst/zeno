(()=>{var z='*{box-sizing:border-box}*:not(input){user-select:none}:focus{outline:0}button{font-family:inherit;font-size:.8rem}main{z-index:99999;position:fixed;left:0;top:0;width:480px;max-width:100vw;height:auto;transform:translateY(calc(-100% + 3rem));display:flex;flex-direction:column;justify-content:end;overflow:hidden;cursor:pointer;background:white;box-shadow:0 .1rem .25rem #0004;border-radius:0 0 .75rem 0;padding:1rem 1rem 0 1rem;font-family:"Google Sans",Roboto,RobotDraft,Helvetica,sans-serif,serif;font-size:1rem}main #collapse{background:white;cursor:pointer;margin-bottom:.5rem}main.focus{transform:none;padding-bottom:1rem;cursor:default}main.minimize{width:1rem;padding-right:0;border-top-right-radius:.75rem}main.minimize :not(#fold),main.minimize #fold :not(#minimize){display:none}main.minimize #minimize{display:block;margin-bottom:1rem}main.focus #fold{display:none}#minimize{font-family:inherit;font-size:.5rem;font-weight:bold;color:#444;text-align:center;border:0;background:white;overflow-wrap:anywhere;cursor:pointer;flex:0 0 1rem;width:1rem;transition:margin-bottom 0s;margin-left:-1rem}#minimize::before{content:"\\25c0";transition:inherit}#minimize:hover::before,main.minimize #minimize::before{margin-left:-2px}main.minimize #minimize::before{content:"\\25b6"}main.minimize:hover #minimize::before{margin-left:0}#previews{grid-template-columns:auto auto auto;grid-auto-rows:max-content;align-items:center;grid-gap:.25rem}#previews video,#previews canvas{width:100%;height:100%;background-image:linear-gradient(90deg,hsl(18,100%,68%) 16.7%,hsl(-10,100%,80%) 16.7%,hsl(-10,100%,80%) 33.3%,hsl(5,90%,72%) 33.3%,hsl(5,90%,72%) 50%,hsl(48,100%,75%) 50%,hsl(48,100%,75%) 66.7%,hsl(36,100%,70%) 66.7%,hsl(36,100%,70%) 83.3%,hsl(20,90%,70%) 83.3%)}#previews canvas{outline:1px green solid}#previews canvas.recording{outline:1px yellow solid}#previews canvas.playback{outline:1px red solid}#title{font-size:1rem;font-weight:normal;text-align:center;color:#444;line-height:1.5rem}:hover #title{transform:translateY(.1rem)}#fold{display:grid}#fold *{grid-row:1;grid-column:1}#previews{display:none}.focus #previews{display:grid;height:auto}#inputs{display:grid;grid-template-columns:auto auto;grid-auto-rows:max-content;margin:1rem 0 1rem 0;align-items:center;grid-row-gap:.15rem}#inputs button,input,#collapse{height:1.5rem;border-radius:.4rem;border:.25rem solid lightgray}#inputs button:hover,input:hover,#collapse:hover{border:.25rem solid gray}#presets>:hover{background:#0003}#presets>:focus{background:black;color:#fff}#presets:focus-within,#collapse:focus{border-color:#000}input[type=range]{-webkit-appearance:none;--gradient: transparent, transparent;--rainbow: hsl(0, 80%, 75%), hsl(30, 80%, 75%), hsl(60, 80%, 75%), hsl(90, 80%, 75%), hsl(120, 80%, 75%), hsl(150, 80%, 75%), hsl(180, 80%, 75%), hsl(210, 80%, 75%), hsl(240, 80%, 75%), hsl(270, 80%, 75%), hsl(300, 80%, 75%), hsl(330, 80%, 75%);background:linear-gradient(90deg,var(--gradient)),linear-gradient(90deg,var(--rainbow))}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:white;width:1rem;height:1rem;border:.25rem solid black;border-radius:.5rem}input[type=range]:focus::-webkit-slider-thumb{border-color:#fff;background:black}input#pillarbox,input#letterbox{--gradient: black, white}';function x(){let b=document.createElement("canvas"),t=b.getContext("2d");return{element:b,context:t}}var w=class{constructor(t,n){this.buffer=x();this.display=x();this.buffer.element.width=this.display.element.width=t,this.buffer.element.height=this.display.element.height=n}blit(){this.display.context.clearRect(0,0,this.display.element.width,this.display.element.height),this.display.context.drawImage(this.buffer.element,0,0)}};function M(b){return new Promise((t,n)=>{b.toBlob(a=>{if(a===null){t(null);return}let r=URL.createObjectURL(a),i=new Image;i.onload=function(){URL.revokeObjectURL(r),t(i)},i.onerror=function(d){n(d)},i.src=r})})}var k=class{constructor(t,n,a){this.width=t;this.height=n;this.frameCount=a;this.frames=[];this.canvas=x();this.idx=0;this.ltr=!0;this.canvas.element.width=t,this.canvas.element.height=n}hasFullBuffer(){return this.frames.length>=this.frameCount}record(t){this.hasFullBuffer()||M(t).then(n=>{n!==null&&this.frames.push(n)})}draw(t){let n=this.frames[this.idx];n!==void 0&&(t.drawImage(n,0,0),this.ltr?this.idx===this.frames.length-1?(this.idx-=1,this.ltr=!1):this.idx+=1:this.idx===0?(this.idx+=1,this.ltr=!0):this.idx-=1)}clearFrames(){this.frames=[],this.idx=0,this.ltr=!0}setFrameCount(t){this.frameCount=t,this.clearFrames()}doneRecording(){this.idx=this.frames.length}};var E=class extends MediaStream{constructor(t,n,a){super(t);let r=document.createElement("video");r.setAttribute("playsinline",""),r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.srcObject=t;let i=document.createElement("input");i.type="checkbox",i.checked=a.childElementCount===0;let d=t.getVideoTracks()[0].getSettings(),c=d.width,l=d.height,p=new w(c,l);a?.append(i,r,p.buffer.element);let m=new k(c,l,n.playbackDuration.valueAsNumber*30);n.playback.addEventListener("change",function(){m.clearFrames()}),n.playbackDuration.addEventListener("change",function(){m.setFrameCount(this.valueAsNumber*30)}),i.addEventListener("change",function(){m.clearFrames()});async function v(){let{context:s,element:u}=p.buffer;s.textAlign="center",s.textBaseline="middle",s.clearRect(0,0,c,l);let g=n.pillarbox.valueAsNumber*c/2,y=n.letterbox.valueAsNumber*l/2;if(i.checked&&n.playback.checked&&m.hasFullBuffer()?(u.classList.contains("recording")&&(u.classList.remove("recording"),u.classList.add("playback"),m.doneRecording()),m.draw(s)):r.srcObject?(u.classList.remove("playback","recording"),s.drawImage(r,0,0),i.checked&&n.playback.checked&&!m.hasFullBuffer()&&(m.record(u),u.classList.add("recording"))):"18, 100%, 68%; -10,100%,80%; 5, 90%, 72%; 48, 100%, 75%; 36, 100%, 70%; 20, 90%, 70%".split(";").forEach((e,h)=>{s.fillStyle=`hsl(${e})`,s.fillRect(h*c/6,0,c/6,l)}),i.checked&&g&&(s.clearRect(0,0,g,l),s.clearRect(c,0,-g,l)),i.checked&&y&&(s.clearRect(0,0,c,y),s.clearRect(0,l,c,-y)),p.blit(),!f.active){t.getTracks().forEach(e=>e.stop()),p.display.context.clearRect(0,0,c,l),a.removeChild(i),a.removeChild(p.buffer.element),a.removeChild(r),r.srcObject=null;return}setTimeout(v,33)}setTimeout(v,33);let f=p.display.element.captureStream(30);return f}};(async function(){"use strict";let t=document.createElement("aside"),n=t.attachShadow({mode:"open"}),a=document.createElement("main");a.addEventListener("click",()=>{a.classList.contains("minimize")?a.classList.remove("minimize"):a.classList.add("focus")});let r=document.createElement("button");r.textContent="\u2191 collapse \u2191",r.id="collapse",r.addEventListener("click",e=>{e.stopPropagation(),a.classList.remove("focus")});let i=document.createElement("button");i.id="minimize",i.title="toggle super tiny mode",i.addEventListener("click",e=>{e.stopPropagation(),a.classList.toggle("minimize")});let d=document.createElement("form");d.id="inputs";let c=document.createElement("style");c.textContent=z;function l(e,h){let C=document.createElement("label");C.textContent=h??e,d.append(C);let o=document.createElement("input");o.id=e,e==="playback"?o.type="checkbox":e==="playbackDuration"?(o.type="number",o.min="1",o.max="10",o.step="1",o.value="2"):(o.type="range",o.min=["pillarbox","letterbox"].includes(e)?"0":"-1",o.max="1",o.step="0.00001",o.value="0");let L=JSON.parse(window.localStorage.getItem(`zeno-value-${o.id}`)??"null");return L!==null&&(o.value=L),d.append(o),o}let p={pillarbox:l("pillarbox"),letterbox:l("letterbox"),playback:l("playback"),playbackDuration:l("playbackDuration","playback duration")};function m(e,h){window.localStorage.setItem(`zeno-value-${e.id}`,JSON.stringify(h))}d.addEventListener("contextmenu",e=>{!(e.target instanceof HTMLInputElement)||e.target.type==="checkbox"||(e.preventDefault(),e.target.value=e.target.min,m(e.target,e.target.valueAsNumber))}),d.addEventListener("input",e=>{let h=e.target;h instanceof HTMLInputElement&&m(h,h.valueAsNumber)});let v=document.createElement("label");v.textContent="reset";let f=document.createElement("button");f.type="button",f.textContent="do it",f.id="reset",f.addEventListener("click",()=>{Object.values(p).forEach(e=>{e.type!=="checkbox"&&(e.value=e.min,m(e,e.valueAsNumber))})}),d.append(v,f);let s=document.createElement("div");s.id="previews";let u=document.createElement("h1");u.id="title",u.textContent="\u2193 Zeno Studio \u2193";let g=document.createElement("div");g.id="fold",g.append(i,u),a.append(r,d,s,g),n.append(a,c),document.body.append(t);async function y(e){return e&&e.video&&!e.audio?new E(await navigator.mediaDevices.oldGetUserMedia(e),p,s):navigator.mediaDevices.oldGetUserMedia(e)}MediaDevices.prototype.oldGetUserMedia=MediaDevices.prototype.getUserMedia,MediaDevices.prototype.getUserMedia=y})();})();
