(()=>{var L='*{box-sizing:border-box}*:not(input){user-select:none}:focus{outline:0}button{font-family:inherit;font-size:.8rem}main{z-index:99999;position:fixed;left:0;top:0;width:480px;max-width:100vw;height:auto;transform:translateY(calc(-100% + 3rem));display:flex;flex-direction:column;justify-content:end;overflow:hidden;cursor:pointer;background:white;box-shadow:0 .1rem .25rem #0004;border-radius:0 0 .75rem 0;padding:1rem 1rem 0 1rem;font-family:"Google Sans",Roboto,RobotDraft,Helvetica,sans-serif,serif;font-size:1rem}main #collapse{background:white;cursor:pointer;margin-bottom:.5rem}main.focus{transform:none;padding-bottom:1rem;cursor:default}main.minimize{width:1rem;padding-right:0;border-top-right-radius:.75rem}main.minimize :not(#fold),main.minimize #fold :not(#minimize){display:none}main.minimize #minimize{display:block;margin-bottom:1rem}main.focus #fold{display:none}#minimize{font-family:inherit;font-size:.5rem;font-weight:bold;color:#444;text-align:center;border:0;background:white;overflow-wrap:anywhere;cursor:pointer;flex:0 0 1rem;width:1rem;transition:margin-bottom 0s;margin-left:-1rem}#minimize::before{content:"\\25c0";transition:inherit}#minimize:hover::before,main.minimize #minimize::before{margin-left:-2px}main.minimize #minimize::before{content:"\\25b6"}main.minimize:hover #minimize::before{margin-left:0}#previews{grid-template-columns:auto auto auto;grid-auto-rows:max-content;align-items:center;grid-gap:.25rem}#previews video,#previews canvas{width:100%;height:100%;background-image:linear-gradient(90deg,hsl(18,100%,68%) 16.7%,hsl(-10,100%,80%) 16.7%,hsl(-10,100%,80%) 33.3%,hsl(5,90%,72%) 33.3%,hsl(5,90%,72%) 50%,hsl(48,100%,75%) 50%,hsl(48,100%,75%) 66.7%,hsl(36,100%,70%) 66.7%,hsl(36,100%,70%) 83.3%,hsl(20,90%,70%) 83.3%)}#previews canvas{outline:1px green solid}#previews canvas.recording{outline:1px yellow solid}#previews canvas.playback{outline:1px red solid}#title{font-size:1rem;font-weight:normal;text-align:center;color:#444;line-height:1.5rem}:hover #title{transform:translateY(.1rem)}#fold{display:grid}#fold *{grid-row:1;grid-column:1}#previews{display:none}.focus #previews{display:grid;height:auto}#inputs{display:grid;grid-template-columns:auto auto;grid-auto-rows:max-content;margin:1rem 0 1rem 0;align-items:center;grid-row-gap:.15rem}#inputs button,input,#collapse{height:1.5rem;border-radius:.4rem;border:.25rem solid lightgray}#inputs button:hover,input:hover,#collapse:hover{border:.25rem solid gray}#presets>:hover{background:#0003}#presets>:focus{background:black;color:#fff}#presets:focus-within,#collapse:focus{border-color:#000}input[type=range]{-webkit-appearance:none;--gradient: transparent, transparent;--rainbow: hsl(0, 80%, 75%), hsl(30, 80%, 75%), hsl(60, 80%, 75%), hsl(90, 80%, 75%), hsl(120, 80%, 75%), hsl(150, 80%, 75%), hsl(180, 80%, 75%), hsl(210, 80%, 75%), hsl(240, 80%, 75%), hsl(270, 80%, 75%), hsl(300, 80%, 75%), hsl(330, 80%, 75%);background:linear-gradient(90deg,var(--gradient)),linear-gradient(90deg,var(--rainbow))}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:white;width:1rem;height:1rem;border:.25rem solid black;border-radius:.5rem}input[type=range]:focus::-webkit-slider-thumb{border-color:#fff;background:black}input#pillarbox,input#letterbox{--gradient: black, white}';function y(){let u=document.createElement("canvas"),t=u.getContext("2d");return{element:u,context:t}}var w=class{constructor(t,n){this.buffer=y();this.display=y();this.buffer.element.width=this.display.element.width=t,this.buffer.element.height=this.display.element.height=n}blit(){this.display.context.clearRect(0,0,this.display.element.width,this.display.element.height),this.display.context.drawImage(this.buffer.element,0,0)}};function M(u,t){let n=performance.now()+u,i=[],l=10,a=0;function p(r){let s=r.concat();if(s.sort((h,o)=>h-o),s.length===0)return 0;let d=Math.floor(s.length/2);return s.length%2!=0?s[d]:(s[d-1]+s[d])/2}setTimeout(c,u);function c(){t();let r=performance.now()-n;r<=u&&(i.push(r+a),a=p(i),i.length>=l&&i.shift()),n+=u,setTimeout(c,Math.max(0,u-r-a))}}var k=class{constructor(t,n,i){this.width=t;this.height=n;this.frameCount=i;this.frames=[];this.canvas=y();this.idx=0;this.ltr=!0;this.recordingStart=performance.now();this.canvas.element.width=t,this.canvas.element.height=n}hasFullBuffer(){return this.frames.length>=this.frameCount}record(t){this.hasFullBuffer()||this.frames.push(t.getImageData(0,0,this.width,this.height))}draw(t){let n=this.frames[this.idx];n!==void 0&&(t.putImageData(n,0,0),this.ltr?this.idx===this.frames.length-1?(this.idx-=1,this.ltr=!1):this.idx+=1:this.idx===0?(this.idx+=1,this.ltr=!0):this.idx-=1)}clearFrames(){this.frames=[],this.idx=0,this.ltr=!0,this.recordingStart=performance.now()}setFrameCount(t){this.frameCount=t,this.clearFrames()}doneRecording(){let n=performance.now()-this.recordingStart,i=(this.frameCount/(n/1e3)).toFixed(2);console.log(`[%cZENO%c] Recording took ${n}ms (avg. framerate ${i} FPS)`,"color: #c03822",""),this.idx=this.frames.length-1}};var E=class extends MediaStream{constructor(t,n,i){super(t);let l=document.createElement("video");l.setAttribute("playsinline",""),l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.srcObject=t;let a=document.createElement("input");a.type="checkbox",a.checked=i.childElementCount===0;let p=t.getVideoTracks()[0].getSettings(),c=p.width,r=p.height,s=new w(c,r);i?.append(a,l,s.buffer.element);let d=new k(c,r,n.playbackDuration.valueAsNumber*30);n.playback.addEventListener("change",function(){d.clearFrames()}),n.playbackDuration.addEventListener("change",function(){d.setFrameCount(this.valueAsNumber*30)}),a.addEventListener("change",function(){d.clearFrames()});function v(){let{context:o,element:f}=s.buffer;o.textAlign="center",o.textBaseline="middle",o.clearRect(0,0,c,r);let b=n.pillarbox.valueAsNumber*c/2,x=n.letterbox.valueAsNumber*r/2;if(a.checked&&n.playback.checked&&d.hasFullBuffer()?(f.classList.contains("recording")&&(f.classList.remove("recording"),f.classList.add("playback"),d.doneRecording()),d.draw(o)):l.srcObject?(f.classList.remove("playback","recording"),o.drawImage(l,0,0),a.checked&&n.playback.checked&&!d.hasFullBuffer()&&(d.record(o),f.classList.add("recording"))):"18, 100%, 68%; -10,100%,80%; 5, 90%, 72%; 48, 100%, 75%; 36, 100%, 70%; 20, 90%, 70%".split(";").forEach((e,g)=>{o.fillStyle=`hsl(${e})`,o.fillRect(g*c/6,0,c/6,r)}),a.checked&&b&&(o.clearRect(0,0,b,r),o.clearRect(c,0,-b,r)),a.checked&&x&&(o.clearRect(0,0,c,x),o.clearRect(0,r,c,-x)),s.blit(),!h.active){t.getTracks().forEach(e=>e.stop()),s.display.context.clearRect(0,0,c,r),i.removeChild(a),i.removeChild(s.buffer.element),i.removeChild(l),l.srcObject=null;return}}M(33,v);let h=s.display.element.captureStream(30);return h}};(async function(){"use strict";let t=document.createElement("aside"),n=t.attachShadow({mode:"open"}),i=document.createElement("main");i.addEventListener("click",()=>{i.classList.contains("minimize")?i.classList.remove("minimize"):i.classList.add("focus")});let l=document.createElement("button");l.textContent="\u2191 collapse \u2191",l.id="collapse",l.addEventListener("click",e=>{e.stopPropagation(),i.classList.remove("focus")});let a=document.createElement("button");a.id="minimize",a.title="toggle super tiny mode",a.addEventListener("click",e=>{e.stopPropagation(),i.classList.toggle("minimize")});let p=document.createElement("form");p.id="inputs";let c=document.createElement("style");c.textContent=L;function r(e,g){let C=document.createElement("label");C.textContent=g??e,p.append(C);let m=document.createElement("input");switch(m.id=e,e){case"playback":m.type="checkbox";break;case"playbackDuration":m.type="number",m.min="1",m.max="10",m.step="1",m.value="2";break;default:m.type="range",m.min=["pillarbox","letterbox"].includes(e)?"0":"-1",m.max="1",m.step="0.00001",m.value="0"}let z=JSON.parse(window.localStorage.getItem(`zeno-value-${m.id}`)??"null");return z!==null&&(m.value=z),p.append(m),m}let s={pillarbox:r("pillarbox"),letterbox:r("letterbox"),playback:r("playback"),playbackDuration:r("playbackDuration","playback duration")};function d(e){window.localStorage.setItem(`zeno-value-${e.id}`,JSON.stringify(e.valueAsNumber))}p.addEventListener("contextmenu",e=>{!(e.target instanceof HTMLInputElement)||e.target.type==="checkbox"||(e.preventDefault(),e.target.value=e.target.min,d(e.target))}),p.addEventListener("input",e=>{let g=e.target;g instanceof HTMLInputElement&&d(g)});let v=document.createElement("label");v.textContent="reset";let h=document.createElement("button");h.type="button",h.textContent="do it",h.id="reset",h.addEventListener("click",()=>{Object.values(s).forEach(e=>{e.type!=="checkbox"&&(e.value=e.min,d(e))})}),p.append(v,h);let o=document.createElement("div");o.id="previews";let f=document.createElement("h1");f.id="title",f.textContent="\u2193 Zeno Studio \u2193";let b=document.createElement("div");b.id="fold",b.append(a,f),i.append(l,p,o,b),n.append(i,c),document.body.append(t);async function x(e){return e&&e.video&&!e.audio?new E(await navigator.mediaDevices.oldGetUserMedia(e),s,o):navigator.mediaDevices.oldGetUserMedia(e)}MediaDevices.prototype.oldGetUserMedia=MediaDevices.prototype.getUserMedia,MediaDevices.prototype.getUserMedia=x})();})();
