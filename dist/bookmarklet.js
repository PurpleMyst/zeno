(()=>{var z='*{box-sizing:border-box}*:not(input){user-select:none}:focus{outline:0}button{font-family:inherit;font-size:.8rem}main{z-index:99999;position:fixed;left:0;top:0;width:480px;max-width:100vw;height:auto;transform:translateY(calc(-100% + 3rem));display:flex;flex-direction:column;justify-content:end;overflow:hidden;cursor:pointer;background:white;box-shadow:0 .1rem .25rem #0004;border-radius:0 0 .75rem 0;padding:1rem 1rem 0 1rem;font-family:"Google Sans",Roboto,RobotDraft,Helvetica,sans-serif,serif;font-size:1rem}main #collapse{background:white;cursor:pointer;margin-bottom:.5rem}main.focus{transform:none;padding-bottom:1rem;cursor:default}main.minimize{width:1rem;padding-right:0;border-top-right-radius:.75rem}main.minimize :not(#fold),main.minimize #fold :not(#minimize){display:none}main.minimize #minimize{display:block;margin-bottom:1rem}main.focus #fold{display:none}#minimize{font-family:inherit;font-size:.5rem;font-weight:bold;color:#444;text-align:center;border:0;background:white;overflow-wrap:anywhere;cursor:pointer;flex:0 0 1rem;width:1rem;transition:margin-bottom 0s;margin-left:-1rem}#minimize::before{content:"\\25c0";transition:inherit}#minimize:hover::before,main.minimize #minimize::before{margin-left:-2px}main.minimize #minimize::before{content:"\\25b6"}main.minimize:hover #minimize::before{margin-left:0}#previews{grid-template-columns:auto auto auto;grid-auto-rows:max-content;align-items:center;grid-gap:.25rem}#previews video,#previews canvas{width:100%;height:100%;background-image:linear-gradient(90deg,hsl(18,100%,68%) 16.7%,hsl(-10,100%,80%) 16.7%,hsl(-10,100%,80%) 33.3%,hsl(5,90%,72%) 33.3%,hsl(5,90%,72%) 50%,hsl(48,100%,75%) 50%,hsl(48,100%,75%) 66.7%,hsl(36,100%,70%) 66.7%,hsl(36,100%,70%) 83.3%,hsl(20,90%,70%) 83.3%)}#previews canvas{outline:1px green solid}#previews canvas.recording{outline:1px yellow solid}#previews canvas.playback{outline:1px red solid}#title{font-size:1rem;font-weight:normal;text-align:center;color:#444;line-height:1.5rem}:hover #title{transform:translateY(.1rem)}#fold{display:grid}#fold *{grid-row:1;grid-column:1}#previews{display:none}.focus #previews{display:grid;height:auto}#inputs{display:grid;grid-template-columns:auto auto;grid-auto-rows:max-content;margin:1rem 0 1rem 0;align-items:center;grid-row-gap:.15rem}#inputs button,input,#collapse{height:1.5rem;border-radius:.4rem;border:.25rem solid lightgray}#inputs button:hover,input:hover,#collapse:hover{border:.25rem solid gray}#presets>:hover{background:#0003}#presets>:focus{background:black;color:#fff}#presets:focus-within,#collapse:focus{border-color:#000}input[type=range]{-webkit-appearance:none;--gradient: transparent, transparent;--rainbow: hsl(0, 80%, 75%), hsl(30, 80%, 75%), hsl(60, 80%, 75%), hsl(90, 80%, 75%), hsl(120, 80%, 75%), hsl(150, 80%, 75%), hsl(180, 80%, 75%), hsl(210, 80%, 75%), hsl(240, 80%, 75%), hsl(270, 80%, 75%), hsl(300, 80%, 75%), hsl(330, 80%, 75%);background:linear-gradient(90deg,var(--gradient)),linear-gradient(90deg,var(--rainbow))}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:white;width:1rem;height:1rem;border:.25rem solid black;border-radius:.5rem}input[type=range]:focus::-webkit-slider-thumb{border-color:#fff;background:black}input#pillarbox,input#letterbox{--gradient: black, white}';function x(){let u=document.createElement("canvas"),t=u.getContext("2d");return{element:u,context:t}}var w=class{constructor(t,n){this.buffer=x();this.display=x();this.buffer.element.width=this.display.element.width=t,this.buffer.element.height=this.display.element.height=n}blit(){this.display.context.clearRect(0,0,this.display.element.width,this.display.element.height),this.display.context.drawImage(this.buffer.element,0,0)}};function M(u){return new Promise((t,n)=>{u.toBlob(i=>{if(i===null){t(null);return}let o=URL.createObjectURL(i),r=new Image;r.onload=function(){URL.revokeObjectURL(o),t(r)},r.onerror=function(p){n(p)},r.src=o})})}function S(u,t){let n=Date.now()+u,i=[],o=10,r=0;function p(a){let s=a.concat();if(s.sort(function(h,l){return h-l}),s.length===0)return 0;let d=Math.floor(s.length/2);return s.length%2?s[d]:(s[d-1]+s[d])/2}setTimeout(c,u);function c(){let a=Date.now()-n;t(),a<=u&&(i.push(a+r),r=p(i),i.length>=o&&i.shift()),n+=u,setTimeout(c,Math.max(0,u-a-r))}}var k=class{constructor(t,n,i){this.width=t;this.height=n;this.frameCount=i;this.frames=[];this.canvas=x();this.idx=0;this.ltr=!0;this.recordingStart=performance.now();this.canvas.element.width=t,this.canvas.element.height=n}hasFullBuffer(){return this.frames.length>=this.frameCount}record(t){this.hasFullBuffer()||M(t).then(n=>{n!==null&&this.frames.push(n)})}draw(t){let n=this.frames[this.idx];n!==void 0&&(t.drawImage(n,0,0),this.ltr?this.idx===this.frames.length-1?(this.idx-=1,this.ltr=!1):this.idx+=1:this.idx===0?(this.idx+=1,this.ltr=!0):this.idx-=1)}clearFrames(){this.frames=[],this.idx=0,this.ltr=!0,this.recordingStart=performance.now()}setFrameCount(t){this.frameCount=t,this.clearFrames()}doneRecording(){let t=performance.now();console.log(`Recording took ${t-this.recordingStart}ms`),this.idx=this.frames.length}};var E=class extends MediaStream{constructor(t,n,i){super(t);let o=document.createElement("video");o.setAttribute("playsinline",""),o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.srcObject=t;let r=document.createElement("input");r.type="checkbox",r.checked=i.childElementCount===0;let p=t.getVideoTracks()[0].getSettings(),c=p.width,a=p.height,s=new w(c,a);i?.append(r,o,s.buffer.element);let d=new k(c,a,n.playbackDuration.valueAsNumber*30);n.playback.addEventListener("change",function(){d.clearFrames()}),n.playbackDuration.addEventListener("change",function(){d.setFrameCount(this.valueAsNumber*30)}),r.addEventListener("change",function(){d.clearFrames()});async function v(){let{context:l,element:f}=s.buffer;l.textAlign="center",l.textBaseline="middle",l.clearRect(0,0,c,a);let b=n.pillarbox.valueAsNumber*c/2,y=n.letterbox.valueAsNumber*a/2;if(r.checked&&n.playback.checked&&d.hasFullBuffer()?(f.classList.contains("recording")&&(f.classList.remove("recording"),f.classList.add("playback"),d.doneRecording()),d.draw(l)):o.srcObject?(f.classList.remove("playback","recording"),l.drawImage(o,0,0),r.checked&&n.playback.checked&&!d.hasFullBuffer()&&(d.record(f),f.classList.add("recording"))):"18, 100%, 68%; -10,100%,80%; 5, 90%, 72%; 48, 100%, 75%; 36, 100%, 70%; 20, 90%, 70%".split(";").forEach((e,g)=>{l.fillStyle=`hsl(${e})`,l.fillRect(g*c/6,0,c/6,a)}),r.checked&&b&&(l.clearRect(0,0,b,a),l.clearRect(c,0,-b,a)),r.checked&&y&&(l.clearRect(0,0,c,y),l.clearRect(0,a,c,-y)),s.blit(),!h.active){t.getTracks().forEach(e=>e.stop()),s.display.context.clearRect(0,0,c,a),i.removeChild(r),i.removeChild(s.buffer.element),i.removeChild(o),o.srcObject=null;return}}S(33,v);let h=s.display.element.captureStream(30);return h}};(async function(){"use strict";let t=document.createElement("aside"),n=t.attachShadow({mode:"open"}),i=document.createElement("main");i.addEventListener("click",()=>{i.classList.contains("minimize")?i.classList.remove("minimize"):i.classList.add("focus")});let o=document.createElement("button");o.textContent="\u2191 collapse \u2191",o.id="collapse",o.addEventListener("click",e=>{e.stopPropagation(),i.classList.remove("focus")});let r=document.createElement("button");r.id="minimize",r.title="toggle super tiny mode",r.addEventListener("click",e=>{e.stopPropagation(),i.classList.toggle("minimize")});let p=document.createElement("form");p.id="inputs";let c=document.createElement("style");c.textContent=z;function a(e,g){let C=document.createElement("label");C.textContent=g??e,p.append(C);let m=document.createElement("input");switch(m.id=e,e){case"playback":m.type="checkbox";break;case"playbackDuration":m.type="number",m.min="1",m.max="10",m.step="1",m.value="2";break;default:m.type="range",m.min=["pillarbox","letterbox"].includes(e)?"0":"-1",m.max="1",m.step="0.00001",m.value="0"}let L=JSON.parse(window.localStorage.getItem(`zeno-value-${m.id}`)??"null");return L!==null&&(m.value=L),p.append(m),m}let s={pillarbox:a("pillarbox"),letterbox:a("letterbox"),playback:a("playback"),playbackDuration:a("playbackDuration","playback duration")};function d(e){window.localStorage.setItem(`zeno-value-${e.id}`,JSON.stringify(e.valueAsNumber))}p.addEventListener("contextmenu",e=>{!(e.target instanceof HTMLInputElement)||e.target.type==="checkbox"||(e.preventDefault(),e.target.value=e.target.min,d(e.target))}),p.addEventListener("input",e=>{let g=e.target;g instanceof HTMLInputElement&&d(g)});let v=document.createElement("label");v.textContent="reset";let h=document.createElement("button");h.type="button",h.textContent="do it",h.id="reset",h.addEventListener("click",()=>{Object.values(s).forEach(e=>{e.type!=="checkbox"&&(e.value=e.min,d(e))})}),p.append(v,h);let l=document.createElement("div");l.id="previews";let f=document.createElement("h1");f.id="title",f.textContent="\u2193 Zeno Studio \u2193";let b=document.createElement("div");b.id="fold",b.append(r,f),i.append(o,p,l,b),n.append(i,c),document.body.append(t);async function y(e){return e&&e.video&&!e.audio?new E(await navigator.mediaDevices.oldGetUserMedia(e),s,l):navigator.mediaDevices.oldGetUserMedia(e)}MediaDevices.prototype.oldGetUserMedia=MediaDevices.prototype.getUserMedia,MediaDevices.prototype.getUserMedia=y})();})();
