// ==UserScript==
// @name      Zeno
// @namespace PurpleMyst
// @match     https://meet.google.com/*
// @grant     none
// ==/UserScript==
(()=>{"use strict";var e={630:e=>{e.exports='* {\r\n  box-sizing: border-box;\r\n  transition: all 200ms;\r\n}\r\n*:not(input) {\r\n  user-select: none;\r\n}\r\n@media (prefers-reduced-motion) {\r\n  * {\r\n    transition: all 0s;\r\n  }\r\n}\r\n:focus {\r\n  outline: 0;\r\n}\r\nmain {\r\n  z-index: 99999;\r\n  position: fixed;\r\n  left: 0;\r\n  top: 0;\r\n  width: 480px;\r\n  max-width: 100vw;\r\n  height: auto;\r\n  min-height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  background: white;\r\n  transform: translateY(calc(-100% + 3rem));\r\n  box-shadow: 0 0.1rem 0.25rem #0004;\r\n  border-radius: 0 0 0.75rem 0;\r\n  padding: 1rem 1rem 0 1rem;\r\n  overflow: hidden;\r\n  font-family: "Google Sans", Roboto, RobotDraft, Helvetica, sans-serif, serif;\r\n  font-size: 1rem;\r\n  cursor: pointer;\r\n}\r\nbutton {\r\n  font-family: inherit;\r\n  font-size: 0.8rem;\r\n}\r\nmain #collapse {\r\n  background: white;\r\n  cursor: pointer;\r\n  margin-bottom: 0.5rem;\r\n}\r\nmain.focus {\r\n  transform: none;\r\n  border-radius: 0;\r\n  height: 100vh;\r\n  padding: 1rem;\r\n  cursor: default;\r\n  overflow: hidden scroll;\r\n}\r\nmain.focus #minimize {\r\n  display: none;\r\n}\r\nmain.minimize {\r\n  width: 1rem;\r\n  padding-right: 0;\r\n}\r\n#minimize {\r\n  font-family: inherit;\r\n  font-size: 0.5rem;\r\n  font-weight: bold;\r\n  color: #444;\r\n  margin-left: -1rem;\r\n  flex: 0 0 1rem;\r\n  width: 1rem;\r\n  text-align: center;\r\n  border: 0;\r\n  background: white;\r\n  cursor: pointer;\r\n  overflow-wrap: anywhere;\r\n}\r\n#minimize::before {\r\n  content: "◀";\r\n  transition: inherit;\r\n}\r\n#minimize:hover::before,\r\n.minimize #minimize::before {\r\n  margin-left: -2px;\r\n}\r\n.minimize #minimize::before {\r\n  content: "▶";\r\n}\r\n.minimize #minimize:hover::before {\r\n  margin-left: 0;\r\n}\r\n#previews {\r\n  margin-top: 1rem;\r\n  height: 3rem;\r\n  display: flex;\r\n}\r\n#previews > video,\r\n#previews > canvas {\r\n  height: 100%;\r\n  width: auto;\r\n  background-image: linear-gradient(\r\n    90deg,\r\n    hsl(18, 100%, 68%) 16.7%,\r\n    hsl(-10, 100%, 80%) 16.7%,\r\n    hsl(-10, 100%, 80%) 33.3%,\r\n    hsl(5, 90%, 72%) 33.3%,\r\n    hsl(5, 90%, 72%) 50%,\r\n    hsl(48, 100%, 75%) 50%,\r\n    hsl(48, 100%, 75%) 66.7%,\r\n    hsl(36, 100%, 70%) 66.7%,\r\n    hsl(36, 100%, 70%) 83.3%,\r\n    hsl(20, 90%, 70%) 83.3%\r\n  );\r\n  margin-right: 1rem;\r\n}\r\n#previews > h1 {\r\n  flex-grow: 1;\r\n  font-size: 1rem;\r\n  font-weight: normal;\r\n  text-align: center;\r\n  color: #444;\r\n  line-height: 1.5rem;\r\n}\r\n:hover > #previews > h1 {\r\n  transform: translateY(0.1rem); /* Tiny nudge downwards */\r\n}\r\n.focus > #previews > h1 {\r\n  display: none;\r\n}\r\n.focus > #previews {\r\n  height: auto;\r\n}\r\n.focus > #previews > * {\r\n  height: auto;\r\n  width: calc(50% - 0.5rem);\r\n}\r\n#presets,\r\nlabel {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n#presets > * {\r\n  border: 0;\r\n  background: transparent;\r\n  flex-grow: 1;\r\n}\r\n#presets > :first-child {\r\n  border-radius: 100px 0 0 100px;\r\n}\r\n#presets > :last-child {\r\n  border-radius: 0 100px 100px 0;\r\n}\r\nlabel {\r\n  height: 2rem;\r\n}\r\nlabel > * {\r\n  width: calc(100% - 6.5rem);\r\n}\r\nlabel > *,\r\n#collapse {\r\n  height: 1.5rem;\r\n  border-radius: 0.75rem;\r\n  border: 0.25rem solid lightgray;\r\n}\r\nlabel > :hover,\r\n#collapse:hover {\r\n  border: 0.25rem solid gray;\r\n}\r\n#presets > :hover {\r\n  background: #0003;\r\n}\r\n#presets > :focus {\r\n  background: black;\r\n  color: white;\r\n}\r\n#presets:focus-within,\r\n#collapse:focus,\r\nlabel > :focus {\r\n  border-color: black;\r\n}\r\ntextarea {\r\n  text-align: center;\r\n  font-family: inherit;\r\n  font-weight: bold;\r\n  resize: none;\r\n  line-height: 1;\r\n}\r\ninput[type="range"] {\r\n  -webkit-appearance: none;\r\n  --gradient: transparent, transparent;\r\n  --rainbow: hsl(0, 80%, 75%), hsl(30, 80%, 75%), hsl(60, 80%, 75%),\r\n    hsl(90, 80%, 75%), hsl(120, 80%, 75%), hsl(150, 80%, 75%),\r\n    hsl(180, 80%, 75%), hsl(210, 80%, 75%), hsl(240, 80%, 75%),\r\n    hsl(270, 80%, 75%), hsl(300, 80%, 75%), hsl(330, 80%, 75%);\r\n  background: linear-gradient(90deg, var(--gradient)),\r\n    linear-gradient(90deg, var(--rainbow));\r\n}\r\ninput[type="range"]::-webkit-slider-thumb {\r\n  -webkit-appearance: none;\r\n  background: white;\r\n  width: 1rem;\r\n  height: 1rem;\r\n  border: 0.25rem solid black;\r\n  border-radius: 0.5rem;\r\n}\r\ninput[type="range"]:focus::-webkit-slider-thumb {\r\n  border-color: white;\r\n  background: black;\r\n}\r\ninput#exposure,\r\ninput#fog,\r\ninput#vignette {\r\n  --gradient: black, #8880, white;\r\n}\r\ninput#contrast {\r\n  --gradient: gray, #8880;\r\n}\r\ninput#temperature {\r\n  --gradient: #88f, #8880, #ff8;\r\n}\r\ninput#tint {\r\n  --gradient: #f8f, #8880, #8f8;\r\n}\r\ninput#sepia {\r\n  --gradient: #8880, #aa8;\r\n}\r\ninput#hue,\r\ninput#rotate {\r\n  background: linear-gradient(\r\n    90deg,\r\n    hsl(0, 80%, 75%),\r\n    hsl(60, 80%, 75%),\r\n    hsl(120, 80%, 75%),\r\n    hsl(180, 80%, 75%),\r\n    hsl(240, 80%, 75%),\r\n    hsl(300, 80%, 75%),\r\n    hsl(0, 80%, 75%),\r\n    hsl(60, 80%, 75%),\r\n    hsl(120, 80%, 75%),\r\n    hsl(180, 80%, 75%),\r\n    hsl(240, 80%, 75%),\r\n    hsl(300, 80%, 75%),\r\n    hsl(0, 80%, 75%)\r\n  );\r\n}\r\ninput#saturate {\r\n  --gradient: gray, #8880 50%, blue, magenta;\r\n}\r\ninput#blur {\r\n  --gradient: #8880, gray;\r\n}\r\ninput#scale,\r\ninput#x,\r\ninput#y,\r\ninput#pillarbox,\r\ninput#letterbox {\r\n  --gradient: black, white;\r\n}\r\n'}},n={};function r(t){var i=n[t];if(void 0!==i)return i.exports;var a=n[t]={exports:{}};return e[t](a,a.exports,r),a.exports}(()=>{var e=r(630);let n;class t extends MediaStream{constructor(e,r,t,i,a){super(e),a.srcObject=e;const o=e.getVideoTracks()[0].getSettings(),s=o.width,l=o.height;Object.values(r).forEach((e=>{e.element.width=s,e.element.height=l}));const c=r.buffer.context,d={state:!1,init:!1,image:document.createElement("img"),canvas:r.freeze};t.freeze.addEventListener("change",(function(){d.state=d.init=this.checked})),c.textAlign="center",c.textBaseline="middle",clearInterval(n),n=setInterval((function(){c.clearRect(0,0,s,l);const e=i.pillarbox*s/2,n=i.letterbox*l/2;if(d.init){d.canvas.context.drawImage(a,0,0,s,l);let e=d.canvas.element.toDataURL("image/png");d.image.setAttribute("src",e),d.init=!1}else d.state?c.drawImage(d.image,0,0,s,l):a.srcObject?c.drawImage(a,0,0,s,l):"18, 100%, 68%; -10,100%,80%; 5, 90%, 72%; 48, 100%, 75%; 36, 100%, 70%; 20, 90%, 70%".split(";").forEach(((e,n)=>{c.fillStyle=`hsl(${e})`,c.fillRect(n*s/6,0,s/6,l)}));e&&(c.clearRect(0,0,e,l),c.clearRect(s,0,-e,l)),n&&(c.clearRect(0,0,s,n),c.clearRect(0,l,s,-n)),r.display.context.clearRect(0,0,s,l),r.display.context.drawImage(r.buffer.element,0,0)}),33);const m=r.display.element.captureStream(30);return m.addEventListener("inactive",(()=>{e.getTracks().forEach((e=>{e.stop()})),r.display.context.clearRect(0,0,s,l),a.srcObject=null})),m}}!async function(){console.trace();const n=document.createElement("aside"),r=document.createElement("main");r.addEventListener("click",(e=>{r.classList.contains("focus")||e.target===i||r.classList.add("focus")}));const i=document.createElement("button");i.textContent="↑ collapse ↑",i.id="collapse",i.addEventListener("click",(()=>{r.classList.remove("focus")}));const a=document.createElement("button");a.id="minimize",a.title="toggle super tiny mode",a.addEventListener("click",(e=>{e.stopPropagation(),r.classList.toggle("minimize")}));const o=document.createElement("form"),s=document.createElement("style");s.textContent=e,o.append(s);const l=JSON.parse(window.localStorage.getItem("mercator-studio-values")??"");const c=Object.fromEntries("pillarbox,letterbox,freeze".split(",").map((e=>{const n=function(e){const n=document.createElement("input");return n.id=e,"freeze"===e?n.type="checkbox":(n.type="range",n.min=["scale","pillarbox","letterbox"].includes(e)?"0":"-1",n.max="1",n.step="0.00001",n.value="0"),n.classList.add("input"),n}(e);l&&(n.value=l[e]);const r=document.createElement("label");return r.textContent=e,o.append(r),r.append(n),[e,n]}))),d=Object.fromEntries(Object.entries(c).map((e=>[e[0],e[1].valueAsNumber||+e[1].value])));function m(e,n){d[e.id]=e.valueAsNumber=n,window.localStorage.setItem("mercator-studio-values",JSON.stringify(d))}o.addEventListener("contextmenu",(e=>{e.target instanceof HTMLInputElement&&"range"===e.target.type&&(e.preventDefault(),m(e.target,0))})),o.addEventListener("input",(e=>{const n=e.target;n instanceof HTMLInputElement&&m(n,n.valueAsNumber)}));const u=document.createElement("label"),p=document.createElement("div");p.id="reset";const h=document.createElement("button");h.textContent=h.id="reset",u.textContent="presets",p.append(h),u.append(p),u.addEventListener("click",(e=>{e.preventDefault(),Object.values(c).forEach((e=>{m(e,0)}))}));const g=document.createElement("div");g.id="previews";const f=document.createElement("video");f.setAttribute("playsinline",""),f.setAttribute("autoplay",""),f.setAttribute("muted","");const b=Object.fromEntries(["buffer","freeze","display"].map((e=>{const n=document.createElement("canvas"),r=n.getContext("2d");return[e,{element:n,context:r}]}))),v=document.createElement("h1");v.textContent="↓ Mercator Studio ↓",g.append(a,f,b.buffer.element,v),o.append(u),r.append(i,o,g),n.append(r),document.body.append(n),MediaDevices.prototype.oldGetUserMedia=MediaDevices.prototype.getUserMedia,MediaDevices.prototype.getUserMedia=async function(e){return console.trace(),e&&e.video&&!e.audio?new t(await navigator.mediaDevices.oldGetUserMedia(e),b,c,d,f):navigator.mediaDevices.oldGetUserMedia(e)},console.trace(),console.dir(MediaDevices.prototype.getUserMedia)}()})()})();