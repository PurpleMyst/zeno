// ==UserScript==
// @name      Zeno
// @namespace PurpleMyst
// @match     https://meet.google.com/*
// @grant     none
// ==/UserScript==
(()=>{"use strict";var e={630:e=>{e.exports='* {\r\n  box-sizing: border-box;\r\n  transition: all 200ms;\r\n}\r\n*:not(input) {\r\n  user-select: none;\r\n}\r\n@media (prefers-reduced-motion) {\r\n  * {\r\n    transition: all 0s;\r\n  }\r\n}\r\n\r\n:focus {\r\n  outline: 0;\r\n}\r\n\r\nbutton {\r\n  font-family: inherit;\r\n  font-size: 0.8rem;\r\n}\r\n\r\nmain {\r\n  /* Position <main> above everything in the top left */\r\n  z-index: 99999;\r\n  position: fixed;\r\n  left: 0;\r\n  top: 0;\r\n  width: 480px;\r\n  max-width: 100vw;\r\n  height: auto;\r\n\r\n  /* When unfocused, show just a portion of <main> */\r\n  transform: translateY(calc(-100% + 3rem));\r\n\r\n  /* <main> is a vertical flexbox container, justified towards the end */\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: end;\r\n\r\n  /* When unfocused, hide the overflow */\r\n  overflow: hidden;\r\n\r\n  /* Indicate that <main> is clickable */\r\n  cursor: pointer;\r\n\r\n  /* General styling */\r\n  background: white;\r\n  box-shadow: 0 0.1rem 0.25rem #0004;\r\n  border-radius: 0 0 0.75rem 0;\r\n  padding: 1rem 1rem 0 1rem;\r\n  font-family: "Google Sans", Roboto, RobotDraft, Helvetica, sans-serif, serif;\r\n  font-size: 1rem;\r\n}\r\n\r\n/* Style for "collapse" text */\r\nmain #collapse {\r\n  background: white;\r\n  cursor: pointer;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n/* Focused <main> */\r\nmain.focus {\r\n  /* This reverts the "default" <main> transform which hides it above the page */\r\n  transform: none;\r\n\r\n  border-radius: 0;\r\n  padding-bottom: 1rem;\r\n  cursor: default;\r\n}\r\n\r\n/* Minimized <main> */\r\nmain.minimize {\r\n  /* Make it smol */\r\n  width: 1rem;\r\n  padding-right: 0;\r\n}\r\n\r\nmain.minimize :not(#fold),\r\nmain.minimize #fold :not(#minimize) {\r\n  /* Anything that\'s not the "unminimize" triangle should be hidden when minimized */\r\n  display: none;\r\n}\r\n\r\nmain.minimize #minimize {\r\n  display: block;\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n/* Hide the fold when focused */\r\nmain.focus #fold {\r\n  /* Use opacity to make it still affect layout */\r\n  opacity: 0;\r\n}\r\n\r\n/* Minimize button */\r\n#minimize {\r\n  /* General styling */\r\n  font-family: inherit;\r\n  font-size: 0.5rem;\r\n  font-weight: bold;\r\n  color: #444;\r\n  text-align: center;\r\n  border: 0;\r\n  background: white;\r\n  overflow-wrap: anywhere;\r\n\r\n  /* Indicate the triangle\'s clickability */\r\n  cursor: pointer;\r\n\r\n  /* Size the triangle as 1rem */\r\n  flex: 0 0 1rem;\r\n  width: 1rem;\r\n\r\n  /* Disable margin-bottom transition */\r\n  transition: margin-bottom 0s;\r\n\r\n  /* When not minimized and not hovered, move to the left */\r\n  margin-left: -1rem;\r\n}\r\n\r\n#minimize::before {\r\n  content: "◀";\r\n  transition: inherit;\r\n}\r\n\r\n#minimize:hover::before,\r\nmain.minimize #minimize::before {\r\n  /* When hovered but not minimized, move to the right */\r\n  /* When not hovered but minimized, move to the left */\r\n  margin-left: -2px;\r\n}\r\n\r\nmain.minimize #minimize::before {\r\n  /* Flip the triangle\'s direction when minimized to indicate unminimization */\r\n  content: "▶";\r\n}\r\n\r\nmain.minimize #minimize:hover::before {\r\n  /* When hovered and minimized, move to the right */\r\n  margin-left: 0;\r\n}\r\n\r\n#previews {\r\n  height: 100%;\r\n  display: flex;\r\n}\r\n\r\n#previews video,\r\n#previews canvas {\r\n  /* show pretty background */\r\n  background-image: linear-gradient(\r\n    90deg,\r\n    hsl(18, 100%, 68%) 16.7%,\r\n    hsl(-10, 100%, 80%) 16.7%,\r\n    hsl(-10, 100%, 80%) 33.3%,\r\n    hsl(5, 90%, 72%) 33.3%,\r\n    hsl(5, 90%, 72%) 50%,\r\n    hsl(48, 100%, 75%) 50%,\r\n    hsl(48, 100%, 75%) 66.7%,\r\n    hsl(36, 100%, 70%) 66.7%,\r\n    hsl(36, 100%, 70%) 83.3%,\r\n    hsl(20, 90%, 70%) 83.3%\r\n  );\r\n}\r\n\r\n#preview-container {\r\n  /* Should be as wide as its parent */\r\n  width: 100%;\r\n\r\n  /* Center everything */\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.preview {\r\n  width: inherit;\r\n\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n#preview-container video,\r\n#preview-container canvas {\r\n  /* The previews should be as wide as the preview container and as high as possible */\r\n  width: inherit;\r\n  height: 100%;\r\n}\r\n\r\n#title {\r\n  font-size: 1rem;\r\n  font-weight: normal;\r\n  text-align: center;\r\n  color: #444;\r\n  line-height: 1.5rem;\r\n}\r\n\r\n:hover #title {\r\n  /* Tiny nudge downwards */\r\n  transform: translateY(0.1rem);\r\n}\r\n\r\n/* Turn the "fold" into a CSS grid. */\r\n#fold {\r\n  display: grid;\r\n}\r\n\r\n/* set every element to have grid androw 1. this works. do i know why? no! */\r\n#fold * {\r\n  grid-row: 1;\r\n  grid-column: 1;\r\n}\r\n\r\n/* Show/hide the previews if focused/unfocused */\r\n#preview-container {\r\n  display: none;\r\n}\r\n\r\n.focus #preview-container {\r\n  display: flex;\r\n}\r\n\r\n.focus #previews {\r\n  height: auto;\r\n}\r\n\r\n/* Style our labels */\r\n\r\nlabel {\r\n  height: 2rem;\r\n}\r\n\r\nlabel > * {\r\n  width: calc(100% - 6.5rem);\r\n}\r\n\r\nlabel > *,\r\n#collapse {\r\n  height: 1.5rem;\r\n  border-radius: 0.75rem;\r\n  border: 0.25rem solid lightgray;\r\n}\r\n\r\nlabel > :hover,\r\n#collapse:hover {\r\n  border: 0.25rem solid gray;\r\n}\r\n\r\n#presets > :hover {\r\n  background: #0003;\r\n}\r\n\r\n#presets > :focus {\r\n  background: black;\r\n  color: white;\r\n}\r\n\r\n#presets:focus-within,\r\n#collapse:focus,\r\nlabel > :focus {\r\n  border-color: black;\r\n}\r\n\r\n/* Style our inputs */\r\n\r\ninput[type="range"] {\r\n  -webkit-appearance: none;\r\n  --gradient: transparent, transparent;\r\n  --rainbow: hsl(0, 80%, 75%), hsl(30, 80%, 75%), hsl(60, 80%, 75%),\r\n    hsl(90, 80%, 75%), hsl(120, 80%, 75%), hsl(150, 80%, 75%),\r\n    hsl(180, 80%, 75%), hsl(210, 80%, 75%), hsl(240, 80%, 75%),\r\n    hsl(270, 80%, 75%), hsl(300, 80%, 75%), hsl(330, 80%, 75%);\r\n  background: linear-gradient(90deg, var(--gradient)),\r\n    linear-gradient(90deg, var(--rainbow));\r\n}\r\n\r\ninput[type="range"]::-webkit-slider-thumb {\r\n  -webkit-appearance: none;\r\n  background: white;\r\n  width: 1rem;\r\n  height: 1rem;\r\n  border: 0.25rem solid black;\r\n  border-radius: 0.5rem;\r\n}\r\n\r\ninput[type="range"]:focus::-webkit-slider-thumb {\r\n  border-color: white;\r\n  background: black;\r\n}\r\n\r\ninput#pillarbox,\r\ninput#letterbox {\r\n  --gradient: black, white;\r\n}\r\n'}},n={};function r(t){var i=n[t];if(void 0!==i)return i.exports;var a=n[t]={exports:{}};return e[t](a,a.exports,r),a.exports}(()=>{var e=r(630);const n="display-preview",t="video-preview";function i(){const e=document.createElement("canvas"),n=e.getContext("2d");return{element:e,context:n}}class a{constructor(e,n){this.buffer=i(),this.display=i(),this.buffer.element.width=this.display.element.width=e,this.buffer.element.height=this.display.element.height=n}blit(){this.display.context.clearRect(0,0,this.display.element.width,this.display.element.height),this.display.context.drawImage(this.buffer.element,0,0)}}class o extends MediaStream{constructor(e,r,o,s){super(e);const l=document.createElement("video");l.setAttribute("playsinline",""),l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.srcObject=e;const d=e.getVideoTracks()[0].getSettings(),c=d.width,m=d.height,h=new a(c,m),u=s.getElementById(t);u?.append(l);const p=s.getElementById(n);p?.append(h.buffer.element);const f={activated:!1,needToInitialize:!1,image:new Image,canvas:i()};f.canvas.element.width=c,f.canvas.element.height=m,r.freeze.addEventListener("change",(function(){f.activated=f.needToInitialize=this.checked}));const g=setInterval((function(){const n=h.buffer.context;n.textAlign="center",n.textBaseline="middle",n.clearRect(0,0,c,m);const r=o.pillarbox*c/2,t=o.letterbox*m/2;if(f.activated){if(f.needToInitialize){f.canvas.context.drawImage(l,0,0,c,m);const e=f.canvas.element.toDataURL("image/png");f.image.src=e,f.needToInitialize=!1}n.drawImage(f.image,0,0,c,m)}else l.srcObject?n.drawImage(l,0,0,c,m):"18, 100%, 68%; -10,100%,80%; 5, 90%, 72%; 48, 100%, 75%; 36, 100%, 70%; 20, 90%, 70%".split(";").forEach(((e,r)=>{n.fillStyle=`hsl(${e})`,n.fillRect(r*c/6,0,c/6,m)}));r&&(n.clearRect(0,0,r,m),n.clearRect(c,0,-r,m)),t&&(n.clearRect(0,0,c,t),n.clearRect(0,m,c,-t)),h.blit(),b.active||(e.getTracks().forEach((e=>e.stop())),h.display.context.clearRect(0,0,c,m),p?.removeChild(h.buffer.element),u?.removeChild(l),l.srcObject=null,clearInterval(g))}),33),b=h.display.element.captureStream(30);return b}}!async function(){const r=document.createElement("aside"),i=r.attachShadow({mode:"open"}),a=document.createElement("main");a.addEventListener("click",(()=>{a.classList.remove("minimize"),a.classList.add("focus")}));const s=document.createElement("button");s.textContent="↑ collapse ↑",s.id="collapse",s.addEventListener("click",(e=>{e.stopPropagation(),a.classList.remove("focus")}));const l=document.createElement("button");l.id="minimize",l.title="toggle super tiny mode",l.addEventListener("click",(e=>{e.stopPropagation(),a.classList.toggle("minimize")}));const d=document.createElement("form"),c=document.createElement("style");c.textContent=e;const m=JSON.parse(window.localStorage.getItem("zeno-values")??"{}");const h=Object.fromEntries("pillarbox,letterbox,freeze".split(",").map((e=>{const n=function(e){const n=document.createElement("input");return n.id=e,"freeze"===e?n.type="checkbox":(n.type="range",n.min=["pillarbox","letterbox"].includes(e)?"0":"-1",n.max="1",n.step="0.00001",n.value="0"),n.classList.add("input"),n}(e);m&&(n.value=m[e]);const r=document.createElement("label");return r.textContent=e,d.append(r),r.append(n),[e,n]}))),u=Object.fromEntries(Object.entries(h).map((e=>[e[0],e[1].valueAsNumber||+e[1].value])));function p(e,n){u[e.id]=e.valueAsNumber=n,window.localStorage.setItem("zeno-values",JSON.stringify(u))}d.addEventListener("contextmenu",(e=>{e.target instanceof HTMLInputElement&&"range"===e.target.type&&(e.preventDefault(),p(e.target,0))})),d.addEventListener("input",(e=>{const n=e.target;n instanceof HTMLInputElement&&p(n,n.valueAsNumber)}));const f=document.createElement("label"),g=document.createElement("button");g.textContent="do it",g.id="reset",f.textContent="reset",f.append(g),f.addEventListener("click",(e=>{e.preventDefault(),Object.values(h).forEach((e=>p(e,0)))})),d.append(f);const b=document.createElement("div");b.id="previews";const v=document.createElement("div");v.id="preview-container";const w=document.createElement("div");w.id=t,w.classList.add("preview");const y=document.createElement("div");y.id=n,y.classList.add("preview"),v.append(w,y);const x=document.createElement("h1");x.id="title",x.textContent="↓ Zeno Studio ↓",b.append(v);const z=document.createElement("div");z.id="fold",z.append(l,x),a.append(s,d,b,z),i.append(a,c),document.body.append(r),MediaDevices.prototype.oldGetUserMedia=MediaDevices.prototype.getUserMedia,MediaDevices.prototype.getUserMedia=async function(e){return e&&e.video&&!e.audio?new o(await navigator.mediaDevices.oldGetUserMedia(e),h,u,i):navigator.mediaDevices.oldGetUserMedia(e)}}()})()})();